<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FARMesilla | Event Inquiry Form | Mesilla, NM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#f5e7d0',
                        primary2: '#e8d9c0',
                        secondary: '#33251e',
                        w: '#fff',
                        b: '#000',
                        accent: '#432f25'
                    },
                    fontFamily: {
                        title: ['"Bernard MT Condensed"', 'serif'],
                        body: ['"Abadi MT Std Light"', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link href="https://db.onlinewebfonts.com/c/a552118ceee33dff8a6acab5d1c10b60?family=Bernard+MT+Condensed+V1" rel="stylesheet">
    <link href="https://db.onlinewebfonts.com/c/0828325a5d135368bf470ed1f2e68d63?family=Abadi+MT+Std+Light" rel="stylesheet">
    <style>
        /* Bernard MT Condensed */
        @font-face {
            font-family: 'Bernard MT Condensed';
            src: url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.eot');
            src: url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.eot?#iefix') format('embedded-opentype'),
                 url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.woff2') format('woff2'),
                 url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.woff') format('woff'),
                 url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.ttf') format('truetype'),
                 url('https://db.onlinewebfonts.com/t/a552118ceee33dff8a6acab5d1c10b60.svg#Bernard MT Condensed V1') format('svg');
            font-style: normal;
            font-display: swap;
        }

        /* Abadi MT Std Light */
        @font-face {
            font-family: 'Abadi MT Std Light';
            src: url('https://db.onlinewebfonts.com/t/0828325a5d135368bf470ed1f2e68d63.eot');
            src: url('https://db.onlinewebfonts.com/t/0828325a5d135368bf470ed1f2e68d63.eot?#iefix') format('embedded-opentype'),
                 url('https://db.onlinewebfonts.com/t/0828325a5d135368bf470ed1f2e68d63.woff2') format('woff2'),
                 url('https://db.onlinewebfonts.com/t/0828325a5d135368bf470ed1f2e68d63.woff') format('woff'),
                 url('https://db.onlinewebfonts.com/t/0828325a5d135368bf470ed1f2e68d63.ttf') format('truetype'),
                 url('https://db.onlinewebfonts.com/t/0828325a5d135368bf470ed1f2e68d63.svg#Abadi MT Std Light') format('svg');
            font-style: normal;
            font-display: swap;
        }

        body {
            background-color: #fbfefb;
            background-image: url('https://www.transparenttextures.com/patterns/concrete-wall-2.png');
            background-repeat: repeat;
            background-size: auto;
            background-blend-mode: multiply;
            font-family: Arial, sans-serif;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://www.transparenttextures.com/patterns/soft-wallpaper.png');
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }

        h1, h2, h3, h4, p1 {
            font-family: 'Bernard MT Condensed', serif;
            font-weight: 500;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            text-decoration: none !important;
        }

        a, a:hover, a:focus, a:visited {
            text-decoration: none !important;
        }

        .section-content {
            position: relative;
            z-index: 2;
        }

        .form-container {
            background-color: #f3e5cf;
            background-image: url("https://transparenttextures.com/patterns/soft-wallpaper.png");
            background-blend-mode: multiply;
            border: 1px solid rgba(51, 37, 30, 0.2);
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(51, 37, 30, 0.2);
            border-radius: 4px;
            background-color: rgba(232, 217, 192, 0.2);
            color: #1a1a1a;
            font-family: 'Abadi MT Std Light', sans-serif;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #432f25;
            box-shadow: 0 0 0 3px rgba(67, 47, 37, 0.1);
        }

        .form-input-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15) !important;
        }

        .form-input::placeholder {
            color: rgba(26, 26, 26, 0.7);
            opacity: 1;
        }

        .form-input:-ms-input-placeholder {
            color: rgba(26, 26, 26, 0.7);
        }

        .form-input::-ms-input-placeholder {
            color: rgba(26, 26, 26, 0.7);
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-family: 'Bernard MT Condensed', serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.875rem;
            color: #33251e;
        }

        .form-section {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-family: 'Bernard MT Condensed', serif;
            text-transform: uppercase;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            letter-spacing: 0.05em;
            text-align: center;
            color: #33251e;
        }

        .budget-or {
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bernard MT Condensed', serif;
            text-transform: uppercase;
            color: #432f25;
            margin: 0 1rem;
            font-size: 1.2rem;
        }

        .submit-btn {
            background-color: #33251e;
            color: #f3e4cf;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-family: 'Bernard MT Condensed', serif;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: none;
            cursor: pointer;
        }

        .submit-btn:hover {
            background-color: #432f25;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .instruction-text {
            font-family: 'Abadi MT Std Light', sans-serif;
            text-transform: lowercase;
            font-size: 0.9rem;
            color: #33251e;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .hidden { display: none; }

        .editable-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #f9fafb;
        }

        .edit-form input, .edit-form textarea, .edit-form select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .save-btn, .edit-btn, .delete-btn, .cancel-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .save-btn { background: #10b981; color: white; }
        .edit-btn { background: #3b82f6; color: white; }
        .delete-btn { background: #ef4444; color: white; }
        .cancel-btn { background: #6b7280; color: white; }

        .flatpickr-day.disabled, .flatpickr-day.disabled:hover {
            background-color: #e5e7eb !important;
            color: #6b7280 !important;
            cursor: not-allowed;
            opacity: 0.6;
        }

        @media (max-width: 768px) {
            .budget-container {
                flex-direction: column;
            }
            
            .budget-or {
                margin: 1rem 0;
            }
        }
    </style>
</head>

<body class="text-secondary">
    <!-- Navigation -->
    <nav class="bg-b top-0 z-50 shadow-md transition-all duration-300" id="main-header" style="background-color: #536872; background-image: url('https://www.transparenttextures.com/patterns/brick-wall-dark.png');"> 
        <div class="container mx-auto px-4 sm:px-6 py-3 md:py-4">
            <div class="flex items-center justify-between">
                <!-- Logo/Brand -->
                <div class="flex items-center space-x-4">
                    <a href="#" class="flex items-center">
                        <img src="logo.png" alt="FARMesilla" class="h-28 md:h-28">
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    

                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center space-x-4">
                    <button id="mobile-account-btn" class="text-primary hover:text-accent transition duration-300 p-2">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </button>
                    <button type="button" class="mobile-menu-button text-primary focus:outline-none">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile menu -->
            <div class="mobile-menu hidden md:hidden pt-4 pb-2">
                <div class="flex flex-col items-center justify-center space-y-3 text-center">

                </div>
            </div>
        </div>
    </nav>

    

  <!-- Event Inquiry Form Section -->
<section id="event-inquiry" class="py-12 md:py-20 section-content">
    <div class="container mx-auto px-4 sm:px-6">
        <div class="form-container max-w-4xl mx-auto">

            <!-- Form Header -->
            <div class="text-center mb-10">
                <h1 class="text-3xl md:text-4xl font-medium font-title mb-4 tracking-wider">EVENT INQUIRY FORM</h1>
                <p class="instruction-text text-lg mb-2">please fill out form clearly</p>
                <p class="instruction-text italic text-sm">an associate will contact you within 48hrs.</p>
            </div>

            <!-- Event Inquiry Form -->
            <form id="event-inquiry-form" novalidate>

                <!-- Contact Information -->
                <div class="form-section">
                    <h2 class="section-title">CONTACT INFORMATION</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">

                        <div>
                            <label class="form-label">
                                TODAY'S DATE <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="date" name="today_date" class="form-input" required>
                        </div>

                        <div>
                            <label class="form-label">
                                NAME <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="text" name="name" class="form-input" placeholder="Enter your name" required>
                        </div>

                        <div>
                            <label class="form-label">
                                PHONE <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="tel" name="phone" class="form-input" placeholder="Enter your phone number" required>
                        </div>

                        <div>
                            <label class="form-label">
                                EMAIL <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="email" name="email" class="form-input" placeholder="Enter your email" required>
                        </div>

                    </div>
                </div>

                <!-- Event Details -->
                <div class="form-section">
                    <h2 class="section-title">EVENT DETAILS</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">

                        <div>
                            <label class="form-label">
                                EVENT DATE <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="text" name="event_date" class="form-input event-date-picker" placeholder="Select event date" required>
                        </div>

                        <div>
                            <label class="form-label">
                                EVENT TIME-FRAME <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="text" name="event_timeframe" class="form-input" placeholder="e.g., 2:00 PM - 5:00 PM" required>
                        </div>

                        <div>
                            <label class="form-label">
                                OCCASION <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="text" name="occasion" class="form-input" placeholder="e.g., Birthday, Wedding, Corporate" required>
                        </div>

                        <div>
                            <label class="form-label">
                                EVENT TYPE <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="text" name="event_type" class="form-input" placeholder="e.g., Formal, Casual, Buffet" required>
                        </div>

                        <div>
                            <label class="form-label">
                                FOOD TYPE <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="text" name="food_type" class="form-input" placeholder="e.g., Mexican, American, Fusion" required>
                        </div>

                        <div>
                            <label class="form-label">
                                NUMBER OF GUESTS <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="number" name="number_guests" class="form-input" placeholder="Enter number of guests" min="1" required>
                        </div>

                    </div>
                </div>

                <!-- Budget Information -->
                <div class="form-section">
                    <h2 class="section-title">BUDGET INFORMATION</h2>
                    <div class="flex budget-container items-start md:items-center">

                        <div class="flex-1">
                            <label class="form-label">
                                TOTAL BUDGET $ <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="number" name="total_budget" class="form-input" placeholder="Total budget amount" min="0" step="0.01">
                        </div>

                        <div class="budget-or">OR</div>

                        <div class="flex-1">
                            <label class="form-label">
                                BUDGET PER PERSON $ <span class="required-tag hidden">* REQUIRED </span>
                            </label>
                            <input type="number" name="budget_per_person" class="form-input" placeholder="Budget per person" min="0" step="0.01">
                        </div>

                    </div>
                    <p class="instruction-text italic mt-3 text-center">
                        please provide either a total budget or a per person budget 
                        <span id="budget-required-tag" class="required-tag hidden">* REQUIRED </span>
                    </p>
                </div>

                <!-- Additional Information -->
                <div class="form-section">
                    <h2 class="section-title">ADDITIONAL INFORMATION</h2>
                    <div class="grid grid-cols-1 gap-4 md:gap-6">

                        <div>
                            <label class="form-label">
                                HOW DID YOU HEAR ABOUT US?
                            </label>
                            <input type="text" name="hear_about" class="form-input" placeholder="e.g., Social media, Friend, Website">
                        </div>

                        <div>
                            <label class="form-label">
                                NOTES FOR OUR CHEF OR COORDINATOR?
                            </label>
                            <textarea name="notes" class="form-input" rows="2" placeholder="Any special requests, dietary restrictions, or other information"></textarea>
                        </div>

                    </div>
                </div>

                <!-- Form Submission -->
                <div class="text-center mt-10">
                    <button type="submit" class="submit-btn">submit inquiry</button>
                    <p class="instruction-text italic mt-5">we'll be in touch within 48 hours to discuss your event!</p>
                </div>

            </form>
        </div>
    </div>
</section>

<!-- Required Tag Style -->
<style>
.required-tag {
    color: red;
    font-size: 0.625rem; /* ~10px */
    font-weight: 500;    /* medium */
    font-family: "Abadi MT Std Light", sans-serif;
}
</style>

    <footer class="border-t border-white/10 py-8" style="background-color: #536872; background-image: url('https://www.transparenttextures.com/patterns/brick-wall-dark.png');"> 
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <!-- Copyright -->
                <div class="mb-4 md:mb-0 text-sm text-white">
                    Â© 2025 FARMesilla
                </div>
                
                <!-- Links -->
                <div class="flex items-center space-x-6">

                    
                    <!-- Social Icons -->
                    <div class="flex items-center space-x-4 ml-4">
                        <a href="https://www.facebook.com/FARMesilla/" class="text-white hover:text-accent transition-colors duration-200" aria-label="Facebook">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-3.128v-3.622h3.128v-2.671c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12v6.988C18.343 21.128 22 16.991 22 12z"/>
                            </svg>
                        </a>
                        <a href="https://www.instagram.com/farmesilla/?hl=en" class="text-white hover:text-accent transition-colors duration-200" aria-label="Instagram">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="BN-Popup/BN-Popup.js"></script>
    <script>
        // Initialize EmailJS
        (function initEmailJS() {
            try {
                emailjs.init('mGAM0CatzjBKJTVe9');
                console.log('EmailJS initialized successfully');
            } catch (error) {
                console.error('EmailJS initialization failed:', error);
            }
        })();

        const CONFIG = {
            REPO: "CateringSystem",
            SUBMISSION_FILE: "contents/eventsubs.json",
            CALENDAR_FILE: "contents/calendar.json",
            BASE_URL: "https://nicholasxdavis.github.io/CateringSystem/contents/"
        };

        async function fetchAndProcessToken() {
            try {
                const cacheBuster = `?t=${new Date().getTime()}`;
                const response = await fetch(`https://nicholasxdavis.github.io/CateringSystem/auth.txt${cacheBuster}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch token');
                }
                const tokenWithAsterisks = await response.text();
                return tokenWithAsterisks.replace(/\*/g, '');
            } catch (error) {
                console.error('Error fetching token:', error);
                alert('Error loading authentication token');
                return null;
            }
        }

        async function fetchFromGitHub(filePath) {
            try {
                const cacheBuster = `?t=${new Date().getTime()}`;
                const response = await fetch(`${CONFIG.BASE_URL}${filePath.replace('contents/', '')}${cacheBuster}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch data: ${response.statusText}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error(`Error fetching ${filePath}:`, error);
                return [];
            }
        }

        async function saveToGitHub(filePath, data) {
            try {
                const token = await fetchAndProcessToken();
                if (!token) {
                    throw new Error('No authentication token available');
                }

                let sha = '';
                try {
                    const existingFile = await fetch(`https://api.github.com/repos/nicholasxdavis/${CONFIG.REPO}/contents/${filePath}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (existingFile.ok) {
                        const fileData = await existingFile.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    console.log('No existing file found, will create new one');
                }

                const content = JSON.stringify(data, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                const response = await fetch(`https://api.github.com/repos/nicholasxdavis/${CONFIG.REPO}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Update ${filePath}`,
                        content: encodedContent,
                        sha: sha
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('GitHub API error:', errorData);
                    throw new Error(`Failed to save ${filePath}: ${response.statusText}`);
                }
                return true;
            } catch (error) {
                console.error(`Error saving ${filePath}:`, error);
                return false;
            }
        }

        async function sendNewEntryEmail(entryData) {
            try {
                let formattedDate = 'Invalid date';
                try {
                    if (entryData.event_date) {
                        const dateOnly = entryData.event_date.split('T')[0];
                        const [year, month, day] = dateOnly.split('-');
                        const correctDate = new Date(year, month - 1, day);
                        formattedDate = correctDate.toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric'
                        });
                    }
                } catch (e) {
                    console.error('Error formatting date:', e);
                }

                const recipients = ['nic@blacnova.net', 'lilsmosh460@gmail.com', 'nicxdavis5@gmail.com'];
                const emailPromises = recipients.map(async (recipient) => {
                    const emailParams = {
                        email: recipient,
                        from_name: 'FARMesilla Catering System',
                        customerName: entryData.name || 'N/A',
                        customerPhone: entryData.phone || 'N/A',
                        'guest#': entryData.number_guests || 'Not specified',
                        reason: entryData.occasion || 'Not specified',
                        date: formattedDate
                    };

                    try {
                        const response = await emailjs.send(
                            'service_g3x1dzf',
                            'template_ptf2tzg',
                            emailParams
                        );
                        console.log('Email sent successfully to:', recipient, response);
                        return { recipient, success: true };
                    } catch (error) {
                        console.error('Error sending email to:', recipient, error);
                        return { recipient, success: false, error };
                    }
                });

                const results = await Promise.all(emailPromises);
                const successful = results.filter(result => result.success);
                console.log(`Sent ${successful.length} out of ${recipients.length} emails successfully`);
                return successful.length > 0;
            } catch (error) {
                console.error('Error in sendNewEntryEmail function:', error);
                return false;
            }
        }

        async function initializeDatePicker() {
            try {
                const calendarData = await fetchFromGitHub(CONFIG.CALENDAR_FILE);
                const unavailableDates = calendarData
                    .filter(entry => entry && entry.date)
                    .map(entry => entry.date.split('T')[0]);

                flatpickr('.event-date-picker', {
                    dateFormat: 'Y-m-d',
                    minDate: 'today',
                    disable: unavailableDates,
                    onReady: function(selectedDates, dateStr, instance) {
                        instance.element.value = dateStr;
                    },
                    onChange: function(selectedDates, dateStr, instance) {
                        instance.element.value = dateStr;
                    }
                });
            } catch (error) {
                console.error('Error initializing date picker:', error);
                document.querySelector('.event-date-picker').type = 'date';
            }
        }

        const eventInquiryForm = document.getElementById('event-inquiry-form');

        if (eventInquiryForm) {
            eventInquiryForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const requiredFields = Array.from(eventInquiryForm.querySelectorAll('[required]'));
                const budgetInstructionTag = document.getElementById('budget-required-tag');

                eventInquiryForm.querySelectorAll('.required-tag').forEach(tag => tag.classList.add('hidden'));
                eventInquiryForm.querySelectorAll('.form-input-error').forEach(input => input.classList.remove('form-input-error'));

                const missingFields = [];

                requiredFields.forEach(field => {
                    const value = (field.value || '').trim();
                    const requiredTag = field.closest('div')?.querySelector('.required-tag');

                    if (!value) {
                        missingFields.push(field);
                        field.classList.add('form-input-error');
                        if (requiredTag) {
                            requiredTag.classList.remove('hidden');
                        }
                    } else if (requiredTag) {
                        requiredTag.classList.add('hidden');
                    }
                });

                const totalBudgetField = eventInquiryForm.querySelector('[name="total_budget"]');
                const budgetPerPersonField = eventInquiryForm.querySelector('[name="budget_per_person"]');

                if (totalBudgetField && budgetPerPersonField) {
                    const totalBudgetValue = (totalBudgetField.value || '').trim();
                    const budgetPerPersonValue = (budgetPerPersonField.value || '').trim();

                    if (!totalBudgetValue && !budgetPerPersonValue) {
                        [totalBudgetField, budgetPerPersonField].forEach(field => {
                            if (!missingFields.includes(field)) {
                                missingFields.push(field);
                            }
                            field.classList.add('form-input-error');
                            const requiredTag = field.closest('div')?.querySelector('.required-tag');
                            if (requiredTag) {
                                requiredTag.classList.remove('hidden');
                            }
                        });
                        if (budgetInstructionTag) {
                            budgetInstructionTag.classList.remove('hidden');
                        }
                    } else {
                        [totalBudgetField, budgetPerPersonField].forEach(field => {
                            const missingIndex = missingFields.indexOf(field);
                            if (missingIndex !== -1) {
                                missingFields.splice(missingIndex, 1);
                            }
                            field.classList.remove('form-input-error');
                            const requiredTag = field.closest('div')?.querySelector('.required-tag');
                            if (requiredTag) {
                                requiredTag.classList.add('hidden');
                            }
                        });
                        if (budgetInstructionTag) {
                            budgetInstructionTag.classList.add('hidden');
                        }
                    }
                }

                if (missingFields.length > 0) {
                    missingFields[0].focus();
                    return;
                }

                const formData = new FormData(eventInquiryForm);
                const todayDateValue = formData.get('today_date');
                const eventDateValue = formData.get('event_date');

                const todayDate = todayDateValue ? new Date(todayDateValue) : null;
                const eventDate = eventDateValue ? new Date(eventDateValue) : null;

                if (todayDate && eventDate && eventDate < todayDate) {
                    alert('Event date cannot be in the past.');
                    const eventDateTag = eventInquiryForm.querySelector('[name="event_date"]')?.closest('div')?.querySelector('.required-tag');
                    const eventDateField = eventInquiryForm.querySelector('[name="event_date"]');
                    if (eventDateField) {
                        eventDateField.classList.add('form-input-error');
                    }
                    if (eventDateTag) {
                        eventDateTag.classList.remove('hidden');
                    }
                    return;
                }

                const entryData = {
                    id: Date.now(),
                    type: 'order',
                    today_date: formData.get('today_date'),
                    name: formData.get('name'),
                    phone: formData.get('phone'),
                    email: formData.get('email'),
                    event_date: formData.get('event_date'),
                    event_timeframe: formData.get('event_timeframe'),
                    occasion: formData.get('occasion'),
                    event_type: formData.get('event_type'),
                    food_type: formData.get('food_type'),
                    number_guests: formData.get('number_guests'),
                    total_budget: formData.get('total_budget') || '',
                    budget_per_person: formData.get('budget_per_person') || '',
                    hear_about: formData.get('hear_about') || '',
                    notes: formData.get('notes') || '',
                    createdAt: new Date().toISOString()
                };

                let submissions = await fetchFromGitHub(CONFIG.SUBMISSION_FILE);
                if (!Array.isArray(submissions)) {
                    submissions = [];
                }

                submissions.push(entryData);

                const saveSuccess = await saveToGitHub(CONFIG.SUBMISSION_FILE, submissions);
                if (saveSuccess) {
                    const emailSuccess = await sendNewEntryEmail(entryData);
                    if (emailSuccess) {
                        console.log('Email notification sent successfully');
                    } else {
                        console.warn('Some or all email notifications failed to send');
                    }
                    alert('Thank you for your inquiry! We will contact you within 48 hours.');
                    eventInquiryForm.reset();
                    eventInquiryForm.querySelectorAll('.form-input-error').forEach(input => input.classList.remove('form-input-error'));
                    eventInquiryForm.querySelectorAll('.required-tag').forEach(tag => tag.classList.add('hidden'));
                    if (budgetInstructionTag) {
                        budgetInstructionTag.classList.add('hidden');
                    }
                } else {
                    alert('Error saving your submission. Please try again later.');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeDatePicker();

            const accountModal = document.getElementById('account-modal');
            const body = document.body;

            function toggleBodyScroll(enable) {
                if (enable) {
                    body.style.overflow = '';
                    body.style.position = '';
                    body.style.height = '';
                    body.style.width = '';
                } else {
                    body.style.overflow = 'hidden';
                    body.style.position = 'fixed';
                    body.style.height = '100%';
                    body.style.width = '100%';
                }
            }

            document.getElementById('account-btn').addEventListener('click', function() {
                accountModal.classList.remove('hidden');
                toggleBodyScroll(false);
            });

            document.getElementById('mobile-account-btn').addEventListener('click', function() {
                accountModal.classList.remove('hidden');
                toggleBodyScroll(false);
            });

            document.getElementById('close-modal').addEventListener('click', function() {
                accountModal.classList.add('hidden');
                toggleBodyScroll(true);
            });

            accountModal.addEventListener('click', function(e) {
                if (e.target === accountModal) {
                    accountModal.classList.add('hidden');
                    toggleBodyScroll(true);
                }
            });

            document.querySelector('.mobile-menu-button').addEventListener('click', function() {
                document.querySelector('.mobile-menu').classList.toggle('hidden');
            });
        });
    </script>
</body>
</html>